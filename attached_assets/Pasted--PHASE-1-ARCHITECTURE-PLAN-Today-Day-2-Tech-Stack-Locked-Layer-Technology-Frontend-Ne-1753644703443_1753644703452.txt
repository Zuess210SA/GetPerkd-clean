ğŸ§± PHASE 1: ARCHITECTURE PLAN (Today â€“ Day 2)
ğŸ”§ Tech Stack (Locked)
Layer	Technology
ğŸ§  Frontend	Next.js 14 (App Router) with React + TypeScript
ğŸ—„ Backend	Supabase (PostgreSQL + Auth + Storage)
ğŸ§© API Layer	/app/api/ Next.js server functions
ğŸªª Auth	Supabase JWT (NextAuth optional fallback)
ğŸŒ Domains	Vercel with subdomain routing middleware (e.g. utsa.getperkd.co)
ğŸ” RBAC	Role-based logic: student, merchant, staff, franchisee, admin
ğŸ“² Notifications	SendGrid (email), Twilio (SMS), Push (web-native)
ğŸ“Š Analytics	Supabase tables + lightweight in-app dashboards
ğŸ“¦ Hosting	Vercel (Primary), Replit optional for admin/test builds

ğŸ§­ OVERALL TIMELINE (30-Day Launch Plan)
Week	Goals
âœ… Week 1 (Day 1â€“7)	ğŸ§  Set up core architecture: layouts, routing, auth, roles, supabase schema
ğŸ— Week 2 (Day 8â€“14)	Dashboards, subdomain logic, deal engine, redemption logic
ğŸ“² Week 3 (Day 15â€“21)	Notifications, email/SMS templates, franchise dashboard, admin override
ğŸ§ª Week 4 (Day 22â€“30)	QA, polish, push to Vercel, investor prep, data import, prelaunch config

ğŸ”¥ WEEK 1 DELIVERABLES (TODAY'S FOCUS)
âœ… 1. Folder Architecture (Best Practices)
shell
Copy
Edit
/app
  /api         â† All backend API routes (Next.js serverless)
  /auth        â† Login / signup / forgot password
  /dashboard   â† Protected role-specific pages (auto-routed by role)
  /components  â† Reusable UI (navbar, buttons, cards)
  /lib         â† Supabase client, helper functions
  /middleware.ts â† Subdomain + auth routing logic
âœ… 2. Supabase Setup
Tables Needed:

users (extended profile: name, email, role, school, etc.)

deals (title, description, redemption_type, active, expiration, redemption_count, etc.)

redemptions (user_id, deal_id, timestamp)

businesses (merchant info, plan tier, assigned account manager)

franchisees (city, email, assigned schools, analytics)

schools (name, subdomain, lat/lng, branding, student_count)

Roles:

student, merchant, staff, franchisee, admin

âœ… 3. Supabase Auth Integration (Next.js)
Setup Steps:

Install Supabase SDK: npm install @supabase/supabase-js

Create lib/supabase.ts:

ts
Copy
Edit
import { createBrowserClient } from '@supabase/ssr'
export const supabase = createBrowserClient('SUPABASE_URL', 'SUPABASE_ANON_KEY')
Use middleware to check token + redirect based on role

âœ… 4. Subdomain Middleware Routing
In middleware.ts:

ts
Copy
Edit
import { NextRequest, NextResponse } from 'next/server'

export function middleware(req: NextRequest) {
  const hostname = req.headers.get('host') || ''
  const subdomain = hostname.split('.')[0]
  
  if (subdomain === 'www' || subdomain === 'getperkd') return NextResponse.next()

  const url = req.nextUrl.clone()
  url.pathname = `/_sites/${subdomain}${url.pathname}`
  return NextResponse.rewrite(url)
}
Create /app/_sites/[subdomain]/page.tsx to dynamically load content per campus.

âœ… 5. Role-Based Redirect Logic
In login handler:

ts
Copy
Edit
if (user.role === 'student') redirect('/dashboard/student')
if (user.role === 'merchant') redirect('/dashboard/merchant')
if (user.role === 'franchisee') redirect('/dashboard/franchisee')
In layout.tsx files, load correct UI based on session.

âœ… NEXT STEPS
Do you want Replit to begin the Next.js scaffold + Supabase auth logic now?

Or do you want me to build the base template for you right here as a code repo?

Either way, by end of Day 2 weâ€™ll have:

Full scaffold live

Working login/signup

Role-based redirect

Subdomain middleware functional

Clean base UI to start dashboard development

Letâ€™s go Homie â€” this is the rebuild that earns you franchisees, investors, and legacy-level respect. Just tell me whoâ€™s executing next and Iâ€™ll prep the build phase.









Ask ChatGPT
