<!DOCTYPE html>
<html>
<head>
    <title>Get Perk'd Auth Debug Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Get Perk'd Auth Debug Test</h1>
    
    <div id="status"></div>
    
    <div style="margin: 20px 0;">
        <h3>Quick Sign In Test</h3>
        <input type="email" id="email" placeholder="Email" value="test@example.com" style="padding: 8px; margin: 5px;">
        <input type="password" id="password" placeholder="Password" value="password123" style="padding: 8px; margin: 5px;">
        <button onclick="testSignIn()" style="padding: 8px 16px; margin: 5px;">Test Sign In</button>
        <button onclick="checkSession()" style="padding: 8px 16px; margin: 5px;">Check Session</button>
        <button onclick="signOut()" style="padding: 8px 16px; margin: 5px;">Sign Out</button>
    </div>
    
    <div id="results" style="background: #f5f5f5; padding: 15px; margin: 20px 0; font-family: monospace; white-space: pre-wrap;"></div>

    <script>
        // Initialize Supabase with same config as app
        const supabaseUrl = 'https://wegpfaogrrtnsqabmssc.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndlZ3BmYW9ncnJ0bnNxYWJtc3NjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NTM3MTMsImV4cCI6MjA2ODAyOTcxM30.Mx3m3C5-NecTcXYg7ba6o7dAt4Uhm7YS9s9z5_-HqIs';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        let results = document.getElementById('results');
        let status = document.getElementById('status');
        
        function log(message) {
            results.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }
        
        function updateStatus(msg) {
            status.textContent = msg;
            status.style.color = msg.includes('Error') ? 'red' : msg.includes('Success') ? 'green' : 'blue';
        }
        
        async function testSignIn() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            log('Testing sign in with: ' + email);
            updateStatus('Testing sign in...');
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) {
                    log('Sign in error: ' + error.message);
                    updateStatus('Sign in failed: ' + error.message);
                } else {
                    log('Sign in successful!');
                    log('User: ' + JSON.stringify(data.user, null, 2));
                    updateStatus('Sign in successful!');
                }
            } catch (err) {
                log('Sign in exception: ' + err.message);
                updateStatus('Sign in error: ' + err.message);
            }
        }
        
        async function checkSession() {
            log('Checking current session...');
            updateStatus('Checking session...');
            
            try {
                const { data, error } = await supabase.auth.getSession();
                
                if (error) {
                    log('Session error: ' + error.message);
                    updateStatus('Session check failed');
                } else if (data.session) {
                    log('Active session found!');
                    log('User: ' + data.session.user.email);
                    log('Session: ' + JSON.stringify(data.session, null, 2));
                    updateStatus('Active session: ' + data.session.user.email);
                } else {
                    log('No active session');
                    updateStatus('No active session');
                }
            } catch (err) {
                log('Session check exception: ' + err.message);
                updateStatus('Session check error');
            }
        }
        
        async function signOut() {
            log('Signing out...');
            updateStatus('Signing out...');
            
            try {
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    log('Sign out error: ' + error.message);
                    updateStatus('Sign out failed');
                } else {
                    log('Sign out successful');
                    updateStatus('Signed out');
                }
            } catch (err) {
                log('Sign out exception: ' + err.message);
                updateStatus('Sign out error');
            }
        }
        
        // Listen for auth state changes
        supabase.auth.onAuthStateChange((event, session) => {
            log('Auth state change: ' + event);
            if (session) {
                log('New session: ' + session.user.email);
            } else {
                log('Session cleared');
            }
        });
        
        // Check initial state
        checkSession();
        
        log('Auth debug test initialized');
        updateStatus('Ready for testing');
    </script>
</body>
</html>