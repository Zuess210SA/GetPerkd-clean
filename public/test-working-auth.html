<!DOCTYPE html>
<html>
<head>
    <title>Test Working Auth</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        button { padding: 10px 20px; margin: 10px 0; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1d4ed8; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Working Authentication Test</h1>
        <p>Direct test of the working authentication system</p>
        
        <button onclick="testLogin()">Test Login</button>
        <button onclick="testAPI()">Test API Call</button>
        <button onclick="clearAuth()">Clear Auth</button>
        
        <div id="result"></div>
    </div>

    <script>
        function showResult(message, isSuccess = true) {
            document.getElementById('result').innerHTML = `<div class="result ${isSuccess ? 'success' : 'error'}">${message}</div>`;
        }

        function testLogin() {
            // Set working authentication
            localStorage.setItem('working_auth_active', 'true');
            localStorage.setItem('working_auth_user', JSON.stringify({
                id: 'working-user-1',
                email: 'robertmcveigh1977@gmail.com',
                username: 'Robert McVeigh',
                role: 'student'
            }));
            
            showResult('‚úÖ Working authentication set! Redirecting to main app...', true);
            
            setTimeout(() => {
                window.location.href = '/';
            }, 2000);
        }

        function testAPI() {
            fetch('/api/user/me')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showResult('‚ùå API Error: ' + data.error, false);
                    } else {
                        showResult('‚úÖ API Success: User loaded: ' + (data.email || 'Unknown user'), true);
                    }
                })
                .catch(error => {
                    showResult('‚ùå Network Error: ' + error.message, false);
                });
        }

        function clearAuth() {
            localStorage.removeItem('working_auth_active');
            localStorage.removeItem('working_auth_user');
            localStorage.removeItem('supabase_token');
            localStorage.removeItem('sb-refresh-token');
            showResult('üóëÔ∏è All authentication data cleared', true);
        }
    </script>
</body>
</html>